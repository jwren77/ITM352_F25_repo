{% extends "base.html" %}
{% block content %}

<div class="mb-2">
    <div class="progress" style="height: 15px;">
        <div class="progress-bar" role="progressbar"
             style="width: {{ progress }}%;"
             aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100">
        </div>
    </div>
</div>

<p>Question {{ index }} of {{ total }}</p>
<p>Score: {{ "%.2f" | format(score) }}</p>

<p><strong>Time left: <span id="time-left">{{ time_left }}</span> seconds</strong></p>

{% if feedback %}
    <p class="feedback {% if is_correct %}feedback-correct{% else %}feedback-wrong{% endif %}">
        {{ feedback }}
    </p>
{% endif %}

<form action="{{ url_for('quiz') }}" method="post">
    <p><strong>{{ question.question }}</strong></p>

    {% for opt in question.options %}
        <div class="form-check">
            <input class="form-check-input" type="radio" name="answer" value="{{ opt }}" id="opt{{ loop.index }}" required>
            <label class="form-check-label" for="opt{{ loop.index }}">
                {{ opt }}
            </label>
        </div>
    {% endfor %}

    <input type="hidden" name="hint_used" id="hint_used" value="0">

    {% if hints_left > 0 %}
        <button type="button" class="btn btn-warning btn-sm mt-2" onclick="showHint()">
            Use Hint ({{ hints_left }} left)
        </button>
        <p id="hint-text" class="mt-2" style="display:none;">
            <strong>Hint:</strong> {{ question.hint }}
        </p>
    {% else %}
        <p class="text-muted mt-2">No hints left for this quiz.</p>
    {% endif %}

    <div class="mt-3">
        <button type="submit" class="btn btn-success">Submit Answer</button>
    </div>
</form>

<script>
let timeLeft = parseInt(document.getElementById("time-left").textContent, 10);

const timerInterval = setInterval(function() {
    timeLeft -= 1;
    if (timeLeft <= 0) {
        clearInterval(timerInterval);
        // Time's up for the quiz, go to result page
        window.location.href = "{{ url_for('result', timed_out=1) }}";
    } else {
        document.getElementById("time-left").textContent = timeLeft;
    }
}, 1000);

function showHint() {
    const hint = document.getElementById("hint-text");
    hint.style.display = "block";
    document.getElementById("hint_used").value = "1";
}
</script>

{% endblock %}